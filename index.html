<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>Bijoy Mazumder ¬∑ Mohor Financial Fitness</title>
  <!-- PDF Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <!-- SheetJS (XLSX) for Excel export -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
      background: #f0f4fa;
      padding: 12px 12px 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .app-container {
      max-width: 560px;
      width: 100%;
    }

    .company-header {
      text-align: center;
      margin: 5px 0 10px;
    }
    .company-name {
      font-size: 1.7rem;
      font-weight: 700;
      color: #063970;
      line-height: 1.2;
      letter-spacing: -0.3px;
      background: linear-gradient(145deg, #ffffff, #e6edf6);
      padding: 16px 12px;
      border-radius: 50px;
      box-shadow: 0 6px 12px rgba(0,40,70,0.08);
      border: 1px solid rgba(46, 91, 136, 0.2);
    }

    h2 {
      font-size: 1.7rem;
      font-weight: 600;
      text-align: center;
      margin: 0.5rem 0 0.8rem;
      color: #0a2f4d;
    }

    .section {
      background: white;
      padding: 20px 18px;
      border-radius: 30px;
      margin-bottom: 20px;
      box-shadow: 0 6px 18px rgba(0, 30, 60, 0.05);
      border: 1px solid #d2e2f2;
    }

    .section h3 {
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 18px;
      color: #113355;
      border-left: 6px solid #2b6c9e;
      padding-left: 16px;
    }

    label {
      font-weight: 500;
      font-size: 1rem;
      color: #1e3a5f;
      display: block;
      margin-bottom: 4px;
      margin-top: 14px;
    }

    input, select {
      width: 100%;
      padding: 16px 18px;
      font-size: 1.1rem;
      border: 1.5px solid #d9e2ef;
      border-radius: 26px;
      background: #fafcff;
      margin-bottom: 6px;
      appearance: none;
      font-family: inherit;
    }

    select {
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="%23333" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>');
      background-repeat: no-repeat;
      background-position: right 18px center;
      background-size: 18px;
    }

    .calc-btn-container {
      margin: 10px 0 30px;
    }
    .primary-btn {
      background: #1d4d7c;
      color: white;
      border: none;
      padding: 20px 16px;
      font-size: 1.5rem;
      font-weight: 700;
      border-radius: 60px;
      width: 100%;
      box-shadow: 0 8px 0 #0b2a44, 0 8px 24px rgba(0,60,120,0.3);
      transition: 0.05s linear;
      letter-spacing: 0.5px;
      touch-action: manipulation;
      cursor: pointer;
    }
    .primary-btn:active {
      transform: translateY(6px);
      box-shadow: 0 2px 0 #0b2a44, 0 10px 20px rgba(0,60,120,0.2);
    }

    .action-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 20px;
      justify-content: center;
    }
    .action-btn {
      flex: 1 1 160px;
      background: white;
      border: 2px solid #1d4d7c;
      color: #1d4d7c;
      font-size: 1.2rem;
      font-weight: 600;
      padding: 14px 8px;
      border-radius: 50px;
      background: #f0f7ff;
      cursor: pointer;
    }
    .action-btn:active {
      background: #d6e8ff;
    }

    .result, .history {
      background: #ffffff;
      border-radius: 32px;
      padding: 24px 18px;
      margin: 15px 0 20px;
      border: 1px solid #c4d8f0;
    }
    .result p {
      font-size: 1.1rem;
      padding: 6px 0;
      border-bottom: 1px dashed #c0d3e8;
    }
    .result hr {
      margin: 16px 0;
      border: 1px solid #d6e5f5;
    }

    .interpret-box {
      background: #e5effb;
      border-radius: 24px;
      padding: 16px;
      margin: 15px 0;
    }
    .interpret-box table {
      width: 100%;
      border-collapse: collapse;
    }
    .interpret-box td {
      padding: 6px 8px;
      border-bottom: 1px solid #b0c8dd;
    }

    .answer-list {
      margin: 15px 0;
    }
    .answer-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #e2ecf9;
    }

    .history-item {
      background: #f8fbfe;
      border-radius: 24px;
      padding: 16px;
      margin-bottom: 16px;
      border: 1px solid #bfd9f0;
    }
    .history-item p {
      margin: 6px 0;
    }
    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      background: #eef3f9;
      padding: 10px 16px;
      border-radius: 30px;
      margin-bottom: 10px;
    }
    .history-header strong {
      color: #0a2f4d;
    }
    .history-detail {
      display: none;
      padding: 10px 0;
    }
    .history-item.expanded .history-detail {
      display: block;
    }

    .clear-btn {
      background: #b13e2d;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 40px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      margin: 10px 0;
      box-shadow: 0 4px 0 #6b2a1e;
    }
    .clear-btn:active {
      transform: translateY(4px);
      box-shadow: 0 1px 0 #6b2a1e;
    }

    @media print {
      .calc-btn-container, .action-row, .clear-btn, .history .section {
        display: none !important;
      }
      body { background: white; }
      .section { box-shadow: none; border: 1px solid #aaa; }
    }
  </style>
</head>
<body>
<div class="app-container">
  <!-- ‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ) -->
  <div class="company-header">
    <div class="company-name">Bijoy Mazumder . Mohor Savings & Insurance Services</div>
  </div>

  <h2>Financial Fitness Assessment</h2>

  <div id="reportArea">
    <!-- ‡¶ï‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶§‡¶•‡ßç‡¶Ø -->
    <div class="section">
      <h3>Client Information</h3>
      <label>Client Name</label>
      <input type="text" id="clientName" placeholder="Full name">

      <label>Address</label>
      <input type="text" id="clientAddress" placeholder="City / street">

      <label>Mobile Number</label>
      <input type="tel" id="clientMobile" placeholder="+91 98765 43210">
    </div>

    <!-- ‡ßß‡ß¶‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® -->
    <div class="section">
      <h3>Assessment Questions</h3>
      <div id="questions"></div>
    </div>

    <!-- ‡¶ñ‡¶∞‡¶ö ‡¶ì ‡¶Ü‡¶Ø‡¶º‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶™‡¶æ‡¶§ -->
    <div class="section">
      <h3>Expenditure / Income Ratio</h3>
      <label>Monthly Family Expenditure (‚Çπ)</label>
      <input type="number" id="monthlyExp" placeholder="e.g. 25000" min="0" step="1000">

      <label>Monthly Family Income (‚Çπ)</label>
      <input type="number" id="monthlyInc" placeholder="e.g. 50000" min="0" step="1000">

      <p style="font-size:1rem; margin-top:8px; color:#2b4f6e;">Expenditure √∑ Income √ó 100 = %</p>
    </div>

    <!-- ‡¶â‡¶™‡¶¶‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ -->
    <div class="section">
      <h3>Advisor Details</h3>
      <label>Advisor Name</label>
      <input type="text" id="advisorName" placeholder="Your name">

      <label>Advisor Mobile</label>
      <input type="tel" id="advisorMobile" placeholder="+91 98765 43210">
    </div>

    <!-- ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® (‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡ßá) -->
    <div class="calc-btn-container">
      <button class="primary-btn" onclick="calculateAndStore()">üìä Calculate Score & Save</button>
    </div>

    <!-- ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá -->
    <div class="result" id="result"></div>
  </div> <!-- reportArea ‡¶∂‡ßá‡¶∑ -->

  <!-- ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∏‡ßá‡¶∏‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ -->
  <div class="history" id="historySection">
    <h3 style="color:#113355; margin-bottom:16px;">üìú Previous Assessments</h3>
    <div id="historyList"></div>
    <button class="clear-btn" onclick="clearHistory()">üóë Clear All History</button>
  </div>

  <!-- PDF, Print ‡¶ì Excel ‡¶¨‡¶æ‡¶ü‡¶® -->
  <div class="action-row">
    <button class="action-btn" onclick="downloadPDF()">üìÑ Export PDF</button>
    <button class="action-btn" onclick="window.print()">üñ® Print Report</button>
    <button class="action-btn" onclick="exportToExcel()">üì• Excel ‡¶è ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
  </div>
</div>

<script>
  // ----- ‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® -----
  const questions = [
    "Do you have life insurance equal to 10 times your annual income?",
    "Do you know how much money you will need monthly after retirement?",
    "Have you calculated the cost of your child‚Äôs education and marriage?",
    "Do you have at least 25 lakh health insurance cover?",
    "If something happens to you, will your loans be fully paid?",
    "Can your family manage expenses for 6 months without income?",
    "Do you invest regularly for your future goals?",
    "Are you confident your current investments will meet future needs?",
    "Do you have an emergency fund for 6 months of expenses?",
    "Do you have a written financial plan with a professional advisor?"
  ];

  // ----- ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ -----
  const container = document.getElementById("questions");
  questions.forEach((q, index) => {
    container.innerHTML += `
      <label id="qlabel${index}">${index+1}. ${q}</label>
      <select id="q${index}">
        <option value="">Select</option>
        <option value="1">Yes</option>
        <option value="0">No</option>
      </select>
    `;
  });

  // ----- ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú‡ßá‡¶∞ ‡¶ï‡ßÄ -----
  const STORAGE_KEY = 'mohor_assessments';

  // ----- ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã -----
  function loadHistory() {
    const history = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    const historyList = document.getElementById('historyList');
    historyList.innerHTML = '';
    if (history.length === 0) {
      historyList.innerHTML = '<p style="text-align:center; color:#777;">No previous assessments found.</p>';
      return;
    }
    // ‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶®‡¶§‡ßÅ‡¶®‡¶ü‡¶æ ‡¶â‡¶™‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá reverse
    history.slice().reverse().forEach((entry, idx) => {
      const itemDiv = document.createElement('div');
      itemDiv.className = 'history-item';
      itemDiv.setAttribute('data-index', idx);

      // ‡¶π‡ßá‡¶°‡¶æ‡¶∞ (‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá)
      const header = document.createElement('div');
      header.className = 'history-header';
      header.innerHTML = `<strong>${entry.clientName || 'Unnamed'}</strong> <span>Score: ${entry.total}/10 | Risk: ${entry.risk}</span>`;
      
      // ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶Ö‡¶Ç‡¶∂ (‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã)
      const detail = document.createElement('div');
      detail.className = 'history-detail';
      detail.innerHTML = `
        <p><strong>Address:</strong> ${entry.address || ''}</p>
        <p><strong>Mobile:</strong> ${entry.mobile || ''}</p>
        <p><strong>Exp/Inc Ratio:</strong> ${entry.ratio}% (${entry.ratioLevel})</p>
        <p><strong>Advisor:</strong> ${entry.advisorName || ''} (${entry.advisorMobile || ''})</p>
        <p><strong>Answers:</strong> ${entry.answers ? entry.answers.map(a => a.answer).join(', ') : ''}</p>
        <p><small>${new Date(entry.timestamp).toLocaleString()}</small></p>
      `;

      itemDiv.appendChild(header);
      itemDiv.appendChild(detail);
      
      header.addEventListener('click', () => {
        itemDiv.classList.toggle('expanded');
      });

      historyList.appendChild(itemDiv);
    });
  }

  // ----- ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡¶æ -----
  function saveAssessment(data) {
    const history = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    history.push(data);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
    loadHistory(); // ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
  }

  // ----- ‡¶∏‡¶¨ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ -----
  function clearHistory() {
    if (confirm('Are you sure you want to delete all saved assessments?')) {
      localStorage.removeItem(STORAGE_KEY);
      loadHistory();
    }
  }

  // ----- ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü ‡¶ì ‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Æ‡ßÇ‡¶≤ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® -----
  function calculateAndStore() {
    // ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π
    let answers = [];
    let total = 0;
    for (let i = 0; i < questions.length; i++) {
      let select = document.getElementById("q" + i);
      let val = select.value;
      let answerText = "";
      if (val === "1") { answerText = "Yes"; total += 1; }
      else if (val === "0") { answerText = "No"; }
      else { answerText = "Not selected"; }
      let qText = document.getElementById(`qlabel${i}`).innerText;
      answers.push({ question: qText, answer: answerText });
    }

    // ‡¶ñ‡¶∞‡¶ö ‡¶ì ‡¶Ü‡¶Ø‡¶º‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶™‡¶æ‡¶§
    let exp = parseFloat(document.getElementById("monthlyExp").value) || 0;
    let inc = parseFloat(document.getElementById("monthlyInc").value) || 0;
    let ratio = (inc > 0) ? (exp / inc) * 100 : 0;
    let ratioFixed = ratio.toFixed(1);

    // ‡¶Ö‡¶®‡ßÅ‡¶™‡¶æ‡¶§‡ßá‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ
    let ratioLevel = "";
    if (ratio <= 45) ratioLevel = "Excellent Financial Position";
    else if (ratio <= 50) ratioLevel = "Good, Minor Improvement Needed";
    else if (ratio <= 65) ratioLevel = "Moderate Risk, Strategic Correction Needed";
    else ratioLevel = "High Risk, Immediate Planning Required";

    // ‡¶ï‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø
    const clientNameField = document.getElementById("clientName").value || "(not provided)";
    const clientAddrField = document.getElementById("clientAddress").value || "(not provided)";
    const clientMobileField = document.getElementById("clientMobile").value || "(not provided)";

    // ‡¶â‡¶™‡¶¶‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø
    const advisorNameField = document.getElementById("advisorName").value || "(not provided)";
    const advisorMobileField = document.getElementById("advisorMobile").value || "(not provided)";

    // ‡¶∞‡¶ø‡¶∏‡ßç‡¶ï ‡¶≤‡ßá‡¶≠‡ßá‡¶≤ (‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ)
    let risk = "";
    if (total >= 8) risk = "Low Risk";
    else if (total >= 5) risk = "Moderate Risk";
    else risk = "High Risk";

    // ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ HTML
    let answersHtml = '<div class="answer-list"><h4>üìã Detailed Answers</h4>';
    answers.forEach((item) => {
      answersHtml += `<div class="answer-item"><span>${item.question}</span> <strong>${item.answer}</strong></div>`;
    });
    answersHtml += '</div>';

    let html = `
      <h3 style="color:#063970;">üë§ ${clientNameField}</h3>
      <p>üìç ${clientAddrField}</p>
      <p>üìû ${clientMobileField}</p>
      <hr>
      <p style="font-size:1.4rem; font-weight:700;">‚úÖ Checklist score: ${total}/10 (${(total/10)*100}%)</p>
      ${answersHtml}
      <div class="interpret-box">
        <p style="font-size:1.3rem; font-weight:600;">üìä Expenditure/Income Ratio</p>
        <p>Expenditure: ‚Çπ${exp.toFixed(0)} | Income: ‚Çπ${inc.toFixed(0)}</p>
        <p style="font-size:1.5rem;">${ratioFixed}%</p>
        <table>
          <tr><td>‚â§ 45%</td><td>Excellent Financial Position</td></tr>
          <tr><td>45‚Äì50%</td><td>Good, Minor Improvement Needed</td></tr>
          <tr><td>50‚Äì65%</td><td>Moderate Risk, Strategic Correction Needed</td></tr>
          <tr><td>> 65%</td><td>High Risk, Immediate Planning Required</td></tr>
        </table>
        <p><strong>Interpretation: ${ratioLevel}</strong></p>
      </div>
      <hr>
      <p><b>Advisor:</b> ${advisorNameField}</p>
      <p><b>Advisor Mobile:</b> ${advisorMobileField}</p>
    `;

    document.getElementById("result").innerHTML = html;

    // ‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§
    const assessmentData = {
      timestamp: new Date().toISOString(),
      clientName: clientNameField,
      address: clientAddrField,
      mobile: clientMobileField,
      total: total,
      risk: risk,
      ratio: ratioFixed,
      ratioLevel: ratioLevel,
      advisorName: advisorNameField,
      advisorMobile: advisorMobileField,
      answers: answers.map(a => ({ answer: a.answer })) // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶≤‡ßã
    };

    saveAssessment(assessmentData);
  }

  // ----- Excel ‡¶è ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá) -----
  function exportToExcel() {
    const history = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

    if (history.length === 0) {
      alert("‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á‡•§ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∏‡ßá‡¶∏‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
      return;
    }

    // Excel-‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡¶æ‡¶ü‡¶æ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü
    const dataForExcel = history.map(entry => ({
      '‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ': new Date(entry.timestamp).toLocaleDateString('bn-BD'),
      '‡¶ï‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ': entry.clientName,
      '‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤': entry.mobile,
      '‡¶∏‡ßç‡¶ï‡ßã‡¶∞': `${entry.total}/10`,
      '‡¶∞‡¶ø‡¶∏‡ßç‡¶ï ‡¶≤‡ßá‡¶≠‡ßá‡¶≤': entry.risk,
      '‡¶ñ‡¶∞‡¶ö-‡¶Ü‡¶Ø‡¶º ‡¶Ö‡¶®‡ßÅ‡¶™‡¶æ‡¶§ (%)': entry.ratio,
      '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶á‡¶ú‡¶æ‡¶∞': entry.advisorName,
      '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶≠‡¶æ‡¶á‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤': entry.advisorMobile
    }));

    // SheetJS ‡¶¶‡¶ø‡ßü‡ßá Excel ‡¶¨‡¶æ‡¶®‡¶æ‡¶®‡ßã
    const worksheet = XLSX.utils.json_to_sheet(dataForExcel);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, 'All Assessments');
    XLSX.writeFile(workbook, 'Financial_History.xlsx');
  }

  // ----- PDF ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü (html2pdf) -----
  function downloadPDF() {
    const element = document.getElementById("reportArea");
    html2pdf().from(element).set({
      margin: [0.5, 0.5, 0.5, 0.5],
      filename: "Mohor_Fitness_Report.pdf",
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, letterRendering: true, useCORS: true },
      jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    }).save();
  }

  // ----- ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì -----
  window.addEventListener('DOMContentLoaded', loadHistory);
</script>
</body>
</html>
